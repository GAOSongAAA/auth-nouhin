<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CollaborPortal - 主頁</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            backdrop-filter: blur(10px);
            text-align: center;
        }

        .header {
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        .status-section {
            margin: 30px 0;
            padding: 20px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .status-section h2 {
            color: #333;
            font-size: 20px;
            margin-bottom: 15px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .status-item span:first-child {
            color: #333;
            font-weight: 500;
        }

        .status-indicator {
            padding: 5px 15px;
            border-radius: 20px;
            color: white;
            font-size: 14px;
            font-weight: 600;
        }

        .status-ok {
            background-color: #27ae60;
        }

        .status-warning {
            background-color: #f39c12;
        }

        .status-error {
            background-color: #e74c3c;
        }

        .navigation-section {
            margin: 30px 0;
        }

        .nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .nav-item {
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            text-decoration: none;
            color: #333;
        }

        .nav-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .nav-item h3 {
            margin-bottom: 10px;
            color: #667eea;
        }

        .nav-item p {
            color: #666;
            font-size: 14px;
        }

        .footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e1e1e1;
            color: #666;
            font-size: 14px;
        }

        .api-test-section {
            margin: 30px 0;
            padding: 20px;
            background: rgba(39, 174, 96, 0.1);
            border-radius: 10px;
            border-left: 4px solid #27ae60;
        }

        .test-button {
            padding: 10px 20px;
            margin: 5px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .test-button:hover {
            background: #5a6fd8;
        }

        .test-results {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 5px;
            border: 1px solid #e1e1e1;
            text-align: left;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>CollaborPortal</h1>
            <p>歡迎來到協作平台 - 系統驗證頁面</p>
        </div>

        <div class="status-section">
            <h2>系統狀態</h2>
            <div class="status-item">
                <span>應用程式狀態</span>
                <span class="status-indicator status-ok" id="appStatus">正常運行</span>
            </div>
            <div class="status-item">
                <span>資料庫連接</span>
                <span class="status-indicator status-ok" id="dbStatus">已連接</span>
            </div>
            <div class="status-item">
                <span>登入服務</span>
                <span class="status-indicator status-ok" id="loginStatus">可用</span>
            </div>
            <div class="status-item">
                <span>JWT 服務</span>
                <span class="status-indicator status-ok" id="jwtStatus">可用</span>
            </div>
        </div>

        <div class="api-test-section">
            <h2>API 測試</h2>
            <p>點擊按鈕測試各項功能</p>
            <div style="margin: 15px 0;">
                <button class="test-button" onclick="testHealthCheck()">健康檢查</button>
                <button class="test-button" onclick="testLoginEndpoint()">登入端點測試</button>
                <button class="test-button" onclick="testJwtValidation()">JWT 驗證測試</button>
                <button class="test-button" onclick="clearResults()">清除結果</button>
            </div>
            <div class="test-results" id="testResults">
                測試結果將顯示在這裡...
            </div>
        </div>

        <div class="navigation-section">
            <h2>快速導航</h2>
            <div class="nav-grid">
                <a href="/login.html" class="nav-item">
                    <h3>使用者登入</h3>
                    <p>訪問登入頁面進行身份驗證</p>
                </a>
                <a href="/auth/login" class="nav-item">
                    <h3>登入 API</h3>
                    <p>直接訪問登入 API 端點</p>
                </a>
                <a href="/actuator/health" class="nav-item">
                    <h3>健康檢查</h3>
                    <p>查看應用程式健康狀態</p>
                </a>
                <a href="/api-docs" class="nav-item">
                    <h3>API 文檔</h3>
                    <p>查看 Swagger API 文檔</p>
                </a>
            </div>
        </div>

        <div class="footer">
            <p>&copy; 2024 CollaborPortal. 版本: 1.0.0</p>
            <p>構建時間: <span id="buildTime"></span></p>
        </div>
    </div>

    <script>
        // 設置構建時間
        document.getElementById('buildTime').textContent = new Date().toLocaleString('zh-TW');

        // 添加日誌函數
        function addTestResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString('zh-TW');
            const typeClass = type === 'error' ? 'color: red;' : type === 'success' ? 'color: green;' : 'color: blue;';
            
            resultsDiv.innerHTML += `<div style="${typeClass}">[${timestamp}] ${message}</div>`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        // 健康檢查測試
        function testHealthCheck() {
            addTestResult('開始健康檢查測試...');
            
            fetch('/actuator/health')
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error(`HTTP ${response.status}`);
                })
                .then(data => {
                    addTestResult(`健康檢查成功: ${JSON.stringify(data)}`, 'success');
                    updateStatus('appStatus', '正常運行', 'ok');
                })
                .catch(error => {
                    addTestResult(`健康檢查失敗: ${error.message}`, 'error');
                    updateStatus('appStatus', '異常', 'error');
                });
        }

        // 登入端點測試
        function testLoginEndpoint() {
            addTestResult('開始登入端點測試...');
            
            // 使用測試憑證
            const testCredentials = {
                username: 'test@example.com',
                password: 'testpassword'
            };

            fetch('/auth/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(testCredentials)
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else if (response.status === 401) {
                    addTestResult('登入端點正常運行 (憑證無效，這是預期的)', 'success');
                    updateStatus('loginStatus', '可用', 'ok');
                    return null;
                }
                throw new Error(`HTTP ${response.status}`);
            })
            .then(data => {
                if (data) {
                    addTestResult(`登入成功: ${JSON.stringify(data)}`, 'success');
                    updateStatus('loginStatus', '可用', 'ok');
                }
            })
            .catch(error => {
                if (error.message.includes('401')) {
                    addTestResult('登入端點正常運行 (憑證無效，這是預期的)', 'success');
                    updateStatus('loginStatus', '可用', 'ok');
                } else {
                    addTestResult(`登入端點測試失敗: ${error.message}`, 'error');
                    updateStatus('loginStatus', '不可用', 'error');
                }
            });
        }

        // JWT 驗證測試
        function testJwtValidation() {
            addTestResult('開始 JWT 驗證測試...');
            
            // 嘗試訪問需要認證的端點
            fetch('/api/protected', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer invalid_token'
                }
            })
            .then(response => {
                if (response.status === 401) {
                    addTestResult('JWT 驗證服務正常運行 (拒絕無效 token)', 'success');
                    updateStatus('jwtStatus', '可用', 'ok');
                } else {
                    addTestResult(`JWT 驗證測試: HTTP ${response.status}`, 'info');
                }
            })
            .catch(error => {
                addTestResult(`JWT 驗證測試失敗: ${error.message}`, 'error');
                updateStatus('jwtStatus', '不可用', 'error');
            });
        }

        // 更新狀態指示器
        function updateStatus(elementId, text, status) {
            const element = document.getElementById(elementId);
            element.textContent = text;
            element.className = `status-indicator status-${status}`;
        }

        // 清除測試結果
        function clearResults() {
            document.getElementById('testResults').innerHTML = '測試結果將顯示在這裡...';
        }

        // 頁面載入時執行初始檢查
        window.addEventListener('load', function() {
            addTestResult('頁面載入完成，開始初始化檢查...', 'info');
            setTimeout(testHealthCheck, 1000);
        });
    </script>
</body>
</html>
